<div class="container my-5 filtro-movimenti-wrapper">
  <h2 class="mb-4 title-sezione">
    <i class="bi bi-funnel-fill"></i> Ricerca Movimenti
  </h2>

  <form [formGroup]="form" (ngSubmit)="cerca()" class="row g-3 filter-form shadow-sm">
    <div class="col-md-6">
      <label class="form-label"><i class="bi bi-list-check"></i> Tipo ricerca:</label>
      <select class="form-select" formControlName="tipoRicerca">
        <option value="1">Ultimi movimenti</option>
        <option value="2">Ultimi movimenti per categoria</option>
        <option value="3">Ultimi movimenti fra due date</option>
      </select>
    </div>

    <div class="col-md-6">
      <label class="form-label"><i class="bi bi-numeric-up"></i> Numero movimenti da visualizzare:</label>
      <input type="number" class="form-control" formControlName="n" placeholder="Es. 10, 20, â€¦" />
    </div>

    <div class="col-md-6" *ngIf="form.value.tipoRicerca === '2'">
      <label class="form-label"><i class="bi bi-tags-fill"></i> Categoria:</label>
      <input type="text" class="form-control" formControlName="categoria" placeholder="Inserisci categoria" />
    </div>

    <div class="col-md-3" *ngIf="form.value.tipoRicerca === '3'">
      <label class="form-label"><i class="bi bi-calendar-start"></i> Data inizio:</label>
      <input type="date" class="form-control" formControlName="dataInizio" />
    </div>

    <div class="col-md-3" *ngIf="form.value.tipoRicerca === '3'">
      <label class="form-label"><i class="bi bi-calendar-end"></i> Data fine:</label>
      <input type="date" class="form-control" formControlName="dataFine" />
    </div>

    <div class="col-12 d-flex justify-content-end">
      <button type="submit" class="btn btn-primary btn-filter">
        <i class="bi bi-search"></i> Cerca
      </button>
    </div>
  </form>

  <div *ngIf="movimenti.length > 0" class="mt-5 risultati-movimenti">
    <h3 class="mb-3 results-title">
      <i class="bi bi-list-ul"></i> Risultati
    </h3>

    <div class="table-responsive">
      <table class="table table-hover align-middle custom-table">
        <thead>
          <tr>
            <th><i class="bi bi-calendar"></i> Data</th>
            <th><i class="bi bi-currency-euro"></i> Importo</th>
            <th><i class="bi bi-tags"></i> Categoria</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of movimenti">
            <td>{{ m.dataCreazione | date:'dd/MM/yyyy' }}</td>
            <td [ngClass]="{'positivo': m.importo > 0, 'negativo': m.importo < 0}">
              {{ m.importo | currency:'EUR' }}
            </td>
            <td>{{ m.NomeCategoria }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="saldoFinale !== null" class="alert saldo-finale mt-4">
      <i class="bi bi-wallet2"></i> Saldo finale: <strong>{{ saldoFinale | currency:'EUR' }}</strong>
    </div>

    <div class="d-flex justify-content-end">
      <button (click)="exportCSV()" class="btn btn-success btn-export">
        <i class="bi bi-download"></i> Esporta CSV
      </button>
    </div>
  </div>
</div>
